import{H as g,b as J,a as U,c as I,d as R,l as K,J as V,e as W,f as F,O as de,D as B,__tla as ue}from"./chunk-81526606.js";import{H as Q,h as X}from"./chunk-49b9528c.js";import{l as q,H as P,a as Z,b as O,c as N,d as G,e as j,f as z,g as x,h as $,C as D,i as tt,j as et,k as it,m as rt,n as E,o as ge,p as mt,q as ft,r as st,s as St,t as he}from"./chunk-336a5005.js";import{D as nt,a as ot,S as pe,b as ye,c as me,__tla as fe}from"./chunk-2df99117.js";Promise.all([(()=>{try{return ue}catch{}})(),(()=>{try{return fe}catch{}})()]).then(async()=>{const bt=(i=!1)=>{i&&console.info("announcements handler")},vt=(i=!1)=>{i&&console.log("announcements injector")},Y=(i,e)=>{var T,y,f,A,u,h,c,C,m,S;try{const w=(f=(y=(T=i==null?void 0:i.querySelector(".listing-link"))==null?void 0:T.querySelector(".v2-listing-card__title"))==null?void 0:y.textContent)==null?void 0:f.trim(),M=(A=i==null?void 0:i.querySelector(".listing-link"))==null?void 0:A.getAttribute("href"),t=i==null?void 0:i.querySelector("img"),v=t!=null&&t.getAttribute("src")?t==null?void 0:t.getAttribute("src"):t==null?void 0:t.getAttribute("data-src");var n=i?(h=(u=i==null?void 0:i.textContent)==null?void 0:u.toLowerCase())==null?void 0:h.includes("Bestseller".toLowerCase()):!1,b=i?(C=(c=i==null?void 0:i.textContent)==null?void 0:c.toLowerCase())==null?void 0:C.includes("Popular now".toLowerCase()):!1,p=i?(S=(m=i==null?void 0:i.textContent)==null?void 0:m.toLowerCase())==null?void 0:S.includes("Etsy\u2019s Pick".toLowerCase()):!1;const r={title:w,listingUrl:M,imageUrl:v,bestSeller:n,popularNow:b,etsyPick:p,...e};chrome.runtime.sendMessage({type:"SAVED_LISTING",payload:r})}catch(w){console.log(w)}},wt=i=>{var f,A,u,h;try{const c=document.querySelector(".body-wrap");var e=c?c.textContent.toLowerCase().includes("Bestseller".toLowerCase()):!1,n=c?c.textContent.toLowerCase().includes("Popular now".toLowerCase()):!1,b=c?c.textContent.toLowerCase().includes("Etsy\u2019s Pick".toLowerCase()):!1,p=(A=(f=c==null?void 0:c.querySelector('h1[data-buy-box-listing-title="true"]'))==null?void 0:f.textContent)==null?void 0:A.trim(),T=(u=document==null?void 0:document.querySelector('meta[property="og:url"]'))==null?void 0:u.getAttribute("content"),y=(h=document==null?void 0:document.querySelector('meta[property="og:image"]'))==null?void 0:h.getAttribute("content");const C={title:p,listingUrl:T,imageUrl:y,bestSeller:e,popularNow:n,etsyPick:b,...i};chrome.runtime.sendMessage({type:"SAVED_LISTING",payload:C})}catch(c){console.log(c)}},At="ol[data-results-grid-container]",qt="ol[data-results-grid-container] > li",Lt=(i=!1)=>{i&&console.info("category handler")},Tt=async(i=!1)=>{i&&console.log("category injector"),(await q.get(P)==null||await q.get(P))&&(setTimeout(ct,2e3),new MutationObserver(e=>{e.forEach(n=>{n.type=="attributes"&&n.target==document.body&&setTimeout(ct,2e3)})}).observe(document.body,{attributes:!0,childList:!1,subtree:!1}))};function Mt(i){const e=/[https:\/\/www.etsy.com\/listing\/]([0-9]+)/;var n;return(n=e.exec(i))!==null?n[1]:!1}const ct=async()=>{const i=await q.get(Z);if(!i)return;const e=await q.getKeys([O,N,G,j,z,x,$]),n=e[O]||D,b=e[N]||tt,p=e[G]||et,T=e[j]?JSON.parse(e[j]):nt,y=e[z]||ot,f=e[x]==null?it:e[x],A=e[$]==null?rt:e[$];if(document.querySelectorAll(At).length>0){var u=document.querySelectorAll(qt);u=Array.from(u).filter(function(t){return t.querySelector("#"+g)===null});for(var h=[...new Set([...u].map(t=>t.hasAttribute("data-palette-listing-id")?t.getAttribute("data-palette-listing-id"):t.querySelector("[data-palette-listing-id]")?t.querySelector("[data-palette-listing-id]").getAttribute("data-palette-listing-id"):t.querySelectorAll(".listing-link").length>0?Mt(t.querySelectorAll(".listing-link")[0].getAttribute("href")):!1).filter(Boolean))],c=0;c<u.length;++c){var C=u[c],m=C,S=m.querySelector("[data-palette-listing-id]")?C.querySelector("[data-palette-listing-id]").getAttribute("data-palette-listing-id"):!1,w=m.hasAttribute("data-palette-listing-id")?m:m.querySelector('[data-palette-listing-id="'+S+'"]');if(w&&w.querySelector("#"+g)===null){const t=document.createElement("div");t.id=g,t.setAttribute("data-heyetsy-listing-id",S);const v={textColor:b,backgroundColor:p,cardShowCategories:f,cardShowTags:A};t.innerHTML=n===E?J(S,v).innerHTML:U(S,v).innerHTML,w.insertAdjacentHTML("beforeend",t.outerHTML)}}for(var M=[];h.length>0;)M.push(h.splice(0,25));M.forEach(t=>{const v=t.toString();fetch(`${Q}/bulk/listings/${v}`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${i}`}}).then(r=>r.ok?r.json():Promise.reject(r)).then(r=>{var d=r.data;for(let l=0;l<d.length;l++){const a=d[l];var o=a==null?void 0:a.listing_id;if(o){const _=X(a,T),L={textColor:b,backgroundColor:p,isHighlight:_,highlightBackgroundColor:y,cardShowCategories:f,cardShowTags:A};var s=document.querySelectorAll('[data-palette-listing-id="'+o+'"]');for(let H=0;H<s.length;H++){const k=s[H];k.querySelector("#"+g)!==null&&(k.querySelector("#"+g).innerHTML=n===E?I(o,a,L).innerHTML:R(o,a,L).innerHTML,Y(k,a))}}}}).catch(r=>{r instanceof Error&&(console.log(r),K.trackEvent(V,{errorMessage:r.message,stack:r.stack}));for(let d=0;d<t.length;d++){const o=t[d];if(o){const s=document.querySelectorAll(`div[data-heyetsy-listing-id="${o}"]`)||[];for(let l=0;l<s.length;l++){const a=s[l];a&&(a.innerHTML=n===E?W(r).innerHTML:F(r).innerHTML)}}}})})}},Ct=25,kt=".responsive-listing-grid, div[data-appears-component-name='shop_home_listings_section']",Ht=".responsive-listing-grid > div, div[data-appears-component-name='shop_home_listings_section'] div.v2-listing-card, div[data-appears-component-name='shop_home_listings_section'] .v2-listing-card",Et=(i=!1)=>{i&&console.info("shop handler")},_t=async(i=!1)=>{i&&console.log("shop injector"),(await q.get(P)==null||await q.get(P))&&(setTimeout(dt,2e3),new MutationObserver(e=>{e.forEach(n=>{n.type=="attributes"&&n.target==document.body&&setTimeout(dt,2e3)})}).observe(document.body,{attributes:!0,childList:!1,subtree:!1}),await xt())};function jt(i){const e=/[https:\/\/www.etsy.com\/listing\/]([0-9]+)/;var n;return(n=e.exec(i))!==null?n[1]:!1}const dt=async()=>{const i=await q.get(Z);if(!i)return;const e=await q.getKeys([O,N,G,j,z,x,$]),n=e[O]||D,b=e[N]||tt,p=e[G]||et,T=e[j]?JSON.parse(e[j]):nt,y=e[z]||ot,f=e[x]==null?it:e[x],A=e[$]==null?rt:e[$];if(document.querySelectorAll(kt).length>0){var u=document.querySelectorAll(Ht);u=Array.from(u).filter(function(t){return t.querySelector("#"+g)===null});for(var h=[...new Set([...u].map(t=>t.hasAttribute("data-palette-listing-id")?t.getAttribute("data-palette-listing-id"):t.querySelector("[data-palette-listing-id]")?t.querySelector("[data-palette-listing-id]").getAttribute("data-palette-listing-id"):t.querySelectorAll(".listing-link").length>0?jt(t.querySelectorAll(".listing-link")[0].getAttribute("href")):!1).filter(Boolean))],c=0;c<u.length;++c){var C=u[c],m=C,S=m.querySelector("[data-palette-listing-id]")?C.querySelector("[data-palette-listing-id]").getAttribute("data-palette-listing-id"):!1,w=m.hasAttribute("data-palette-listing-id")?m:m.querySelector('[data-palette-listing-id="'+S+'"]');if(w&&w.querySelector("#"+g)===null){const t=document.createElement("div");t.id=g,t.setAttribute("data-heyetsy-listing-id",S);const v={textColor:b,backgroundColor:p,cardShowCategories:f,cardShowTags:A};t.innerHTML=n===E?J(S,v).innerHTML:U(S,v).innerHTML,w.insertAdjacentHTML("beforeend",t.outerHTML)}}for(var M=[];h.length>0;)M.push(h.splice(0,Ct));M.forEach(t=>{const v=t.toString();fetch(`${Q}/bulk/listings/${v}`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${i}`}}).then(r=>r.ok?r.json():Promise.reject(r)).then(r=>{var d=r.data;for(let l=0;l<d.length;l++){const a=d[l];var o=a==null?void 0:a.listing_id;if(o){const _=X(a,T),L={textColor:b,backgroundColor:p,isHighlight:_,highlightBackgroundColor:y,cardShowCategories:f,cardShowTags:A};var s=document.querySelectorAll('[data-palette-listing-id="'+o+'"]');for(let H=0;H<s.length;H++){const k=s[H];k.querySelector("#"+g)!==null&&(k.querySelector("#"+g).innerHTML=n===E?I(o,a,L).innerHTML:R(o,a,L).innerHTML,Y(k,a))}}}}).catch(r=>{r instanceof Error&&K.trackEvent(V,{errorMessage:r.message,stack:r.stack});for(let d=0;d<t.length;d++){const o=t[d];if(o){const s=document.querySelectorAll(`div[data-heyetsy-listing-id="${o}"]`)||[];for(let l=0;l<s.length;l++){const a=s[l];a&&(a.innerHTML=n===E?W(r).innerHTML:F(r).innerHTML)}}}})})}},xt=async()=>{var b,p;const i=await q.getKeys([ge,mt,ft,st]);if(!!(i[st]===void 0||i[st]))if((i[ft]||pe)===ye)i[mt]||me;else{const T=(p=(b=window.location.pathname.match(/\/shop\/(.*)/))==null?void 0:b[1])==null?void 0:p.trim();if(T){if(!document.getElementById("heyEtsyIframeShop")){var e=document.createElement("div");e.setAttribute("id","heyEtsyIframeShop"),e.style.maxWidth="1400px",e.style.margin="0 auto";var n=document.createElement("iframe");n.style.height="650px",n.style.width="100%",n.style.border="none",n.setAttribute("src","https://etsy.ytuong.me/iframe/shops/"+T),e.appendChild(n);const y=document.querySelector("div.shop-home-header")||document.querySelector('div[data-appears-component-name="shop_home_announcement_section"]');y&&y.insertAdjacentElement("afterend",e)}}else if(!document.getElementById("heyEtsyIframeShop")){var n=document.createElement("iframe");n.setAttribute("id","heyEtsyIframeShop"),n.style.height="650px",n.style.width="100%",n.style.border="none",n.setAttribute("src",chrome.runtime.getURL("popup.html#/shop-not-found"));const f=document.querySelector('div[data-appears-component-name="shop_home_announcement_section"]');f&&f.insertAdjacentElement("afterend",n)}}},$t=25,Bt=".responsive-listing-grid",Pt=".responsive-listing-grid > li, .responsive-listing-grid > div",Ot=".image-carousel-container",Nt="#listing-page-cart",Gt=(i=!1)=>{i&&console.info("listing handler")},zt=async(i=!1)=>{i&&console.log("listing injector"),(await q.get(P)==null||await q.get(P))&&(setTimeout(gt,2e3),new MutationObserver(e=>{e.forEach(n=>{n.type=="attributes"&&n.target==document.body&&setTimeout(gt,2e3)})}).observe(document.body,{attributes:!0,childList:!1,subtree:!1}))};function ut(i){const e=/[https:\/\/www.etsy.com\/listing\/]([0-9]+)/;var n;return(n=e.exec(i))!==null?n[1]:!1}const gt=async()=>{const i=await q.get(Z);if(!i)return;const e=await q.getKeys([O,N,G,j,z,x,$]),n=e[O]||D,b=e[N]||tt,p=e[G]||et,T=e[j]?JSON.parse(e[j]):nt,y=e[z]||ot,f=e[x]==null?it:e[x],A=e[$]==null?rt:e[$],u=ut(window.location.href);let h=document.querySelector(Ot);if(n===D&&(h=document.querySelector(Nt)),u&&h&&h.querySelector("#"+g)===null){const r=document.createElement("div");r.id=g,r.setAttribute("style","padding-top: 10px; padding-bottom: 10px;"),r.setAttribute("data-heyetsy-listing-id",u);const d={textColor:b,backgroundColor:p,cardShowCategories:f,cardShowTags:A};r.innerHTML=n===E?J(M,d).innerHTML:U(M,d).innerHTML,n===D?h.insertAdjacentHTML("afterbegin",r.outerHTML):h.insertAdjacentHTML("beforeend",r.outerHTML),fetch(`${Q}/listings/${u}`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${i}`}}).then(o=>o.ok?o.json():Promise.reject(o)).then(o=>{const s=o.data;var l=s==null?void 0:s.listing_id;if(l){const a=X(s,T),_={textColor:b,backgroundColor:p,isHighlight:a,highlightBackgroundColor:y,cardShowCategories:f,cardShowTags:A};h.querySelector("#"+g)!==null&&(h.querySelector("#"+g).innerHTML=n===E?I(l,s,_).innerHTML:R(l,s,_).innerHTML,wt(s))}}).catch(o=>{o instanceof Error&&K.trackEvent(V,{errorMessage:o.message,stack:o.stack}),h.querySelector("#"+g)!==null&&(h.querySelector("#"+g).innerHTML=n===E?W(o).innerHTML:F(o).innerHTML)})}if(document.querySelectorAll(Bt).length>0){var c=document.querySelectorAll(Pt);c=Array.from(c).filter(function(r){return r.querySelector("#"+g)===null});for(var C=[...new Set([...c].map(r=>r.hasAttribute("data-palette-listing-id")?r.getAttribute("data-palette-listing-id"):r.querySelector("[data-palette-listing-id]")?r.querySelector("[data-palette-listing-id]").getAttribute("data-palette-listing-id"):r.querySelectorAll(".listing-link").length>0?ut(r.querySelectorAll(".listing-link")[0].getAttribute("href")):!1).filter(Boolean))],m=0;m<c.length;++m){var S=c[m],w=S,M=w.querySelector("[data-palette-listing-id]")?S.querySelector("[data-palette-listing-id]").getAttribute("data-palette-listing-id"):!1,t=w.hasAttribute("data-palette-listing-id")?w:w.querySelector('[data-palette-listing-id="'+M+'"]');if(t&&t.querySelector("#"+g)===null){const r=document.createElement("div");r.id=g,r.setAttribute("data-heyetsy-listing-id",M);const d={textColor:b,backgroundColor:p,cardShowCategories:f,cardShowTags:A};r.innerHTML=n===E?J(M,d).innerHTML:U(M,d).innerHTML,t.insertAdjacentHTML("beforeend",r.outerHTML)}}for(var v=[];C.length>0;)v.push(C.splice(0,$t));v.forEach(r=>{const d=r.toString();fetch(`${Q}/bulk/listings/${d}`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${i}`}}).then(o=>o.ok?o.json():Promise.reject(o)).then(o=>{var s=o.data;for(let _=0;_<s.length;_++){const L=s[_];var l=L==null?void 0:L.listing_id;if(l){const H=X(L,T),k={textColor:b,backgroundColor:p,isHighlight:H,highlightBackgroundColor:y,cardShowCategories:f,cardShowTags:A};var a=document.querySelectorAll('[data-palette-listing-id="'+l+'"]');for(let at=0;at<a.length;at++){const lt=a[at];lt.querySelector("#"+g)!==null&&(lt.querySelector("#"+g).innerHTML=n===E?I(l,L,k).innerHTML:R(l,L,k).innerHTML,Y(lt,L))}}}}).catch(o=>{o instanceof Error&&K.trackEvent(V,{errorMessage:o.message,stack:o.stack});for(let s=0;s<r.length;s++){const l=r[s];if(l){const a=document.querySelectorAll(`div[data-heyetsy-listing-id="${l}"]`)||[];for(let _=0;_<a.length;_++){const L=a[_];L&&(L.innerHTML=n===E?W(o).innerHTML:F(o).innerHTML)}}}})})}},Kt=25,Dt=".responsive-listing-grid, ul[data-listings-grid]",Jt=".responsive-listing-grid > li, .responsive-listing-grid > div, ul[data-listings-grid] > div",Ut=(i=!1)=>{i&&console.info("people handler")},It=async(i=!1)=>{i&&console.log("people injector"),(await q.get(P)==null||await q.get(P))&&(setTimeout(ht,2e3),new MutationObserver(e=>{e.forEach(n=>{n.type=="attributes"&&n.target==document.body&&setTimeout(ht,2e3)})}).observe(document.body,{attributes:!0,childList:!1,subtree:!1}))};function Rt(i){const e=/[https:\/\/www.etsy.com\/listing\/]([0-9]+)/;var n;return(n=e.exec(i))!==null?n[1]:!1}const ht=async()=>{const i=await q.get(Z);if(!i)return;const e=await q.getKeys([O,N,G,j,z,x,$]),n=e[O]||D,b=e[N]||tt,p=e[G]||et,T=e[j]?JSON.parse(e[j]):nt,y=e[z]||ot,f=e[x]==null?it:e[x],A=e[$]==null?rt:e[$];if(document.querySelectorAll(Dt).length>0){var u=document.querySelectorAll(Jt);u=Array.from(u).filter(function(t){return t.querySelector("#"+g)===null});for(var h=[...new Set([...u].map(t=>t.hasAttribute("data-palette-listing-id")?t.getAttribute("data-palette-listing-id"):t.querySelector("[data-palette-listing-id]")?t.querySelector("[data-palette-listing-id]").getAttribute("data-palette-listing-id"):t.querySelectorAll(".listing-link").length>0?Rt(t.querySelectorAll(".listing-link")[0].getAttribute("href")):!1).filter(Boolean))],c=0;c<u.length;++c){var C=u[c],m=C,S=m.querySelector("[data-palette-listing-id]")?C.querySelector("[data-palette-listing-id]").getAttribute("data-palette-listing-id"):!1,w=m.hasAttribute("data-palette-listing-id")?m:m.querySelector('[data-palette-listing-id="'+S+'"]');if(w&&w.querySelector("#"+g)===null){const t=document.createElement("div");t.id=g,t.setAttribute("data-heyetsy-listing-id",S);const v={textColor:b,backgroundColor:p,cardShowCategories:f,cardShowTags:A};t.innerHTML=n===E?J(S,v).innerHTML:U(S,v).innerHTML,w.insertAdjacentHTML("beforeend",t.outerHTML)}}for(var M=[];h.length>0;)M.push(h.splice(0,Kt));M.forEach(t=>{const v=t.toString();fetch(`${Q}/bulk/listings/${v}`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${i}`}}).then(r=>r.ok?r.json():Promise.reject(r)).then(r=>{var d=r.data;for(let l=0;l<d.length;l++){const a=d[l];var o=a==null?void 0:a.listing_id;if(o){const _=X(a,T),L={textColor:b,backgroundColor:p,isHighlight:_,highlightBackgroundColor:y,cardShowCategories:f,cardShowTags:A};var s=document.querySelectorAll('[data-palette-listing-id="'+o+'"]');for(let H=0;H<s.length;H++){const k=s[H];k.querySelector("#"+g)!==null&&(k.querySelector("#"+g).innerHTML=n===E?I(o,a,L).innerHTML:R(o,a,L).innerHTML,Y(k,a))}}}}).catch(r=>{r instanceof Error&&(console.log(r),K.trackEvent(V,{errorMessage:r.message,stack:r.stack}));for(let d=0;d<t.length;d++){const o=t[d];if(o){const s=document.querySelectorAll(`div[data-heyetsy-listing-id="${o}"]`)||[];for(let l=0;l<s.length;l++){const a=s[l];a&&(a.innerHTML=n===E?W(r).innerHTML:F(r).innerHTML)}}}})})}},Vt=25,Wt="ul.wt-block-grid, .search-listings-group",Ft="ul.wt-block-grid > li, .search-listings-group li",Qt=(i=!1)=>{i&&console.info("search handler")},Xt=async(i=!1)=>{i&&console.log("search injector"),(await q.get(P)==null||await q.get(P))&&(setTimeout(pt,2e3),new MutationObserver(e=>{e.forEach(n=>{n.type=="attributes"&&n.target==document.body&&setTimeout(pt,2e3)})}).observe(document.body,{attributes:!0,childList:!1,subtree:!1}))};function Yt(i){const e=/[https:\/\/www.etsy.com\/listing\/]([0-9]+)/;var n;return(n=e.exec(i))!==null?n[1]:!1}const pt=async()=>{const i=await q.get(Z);if(!i)return;const e=await q.getKeys([O,N,G,j,z,x,$]),n=e[O]||D,b=e[N]||tt,p=e[G]||et,T=e[j]?JSON.parse(e[j]):nt,y=e[z]||ot,f=e[x]==null?it:e[x],A=e[$]==null?rt:e[$];if(document.querySelectorAll(Wt).length>0){var u=document.querySelectorAll(Ft);u=Array.from(u).filter(function(t){return t.querySelector("#"+g)===null});for(var h=[...new Set([...u].map(t=>t.hasAttribute("data-palette-listing-id")?t.getAttribute("data-palette-listing-id"):t.querySelector("[data-palette-listing-id]")?t.querySelector("[data-palette-listing-id]").getAttribute("data-palette-listing-id"):t.querySelectorAll(".listing-link").length>0?Yt(t.querySelectorAll(".listing-link")[0].getAttribute("href")):!1).filter(Boolean))],c=0;c<u.length;++c){var C=u[c],m=C,S=m.querySelector("[data-palette-listing-id]")?C.querySelector("[data-palette-listing-id]").getAttribute("data-palette-listing-id"):!1,w=m.hasAttribute("data-palette-listing-id")?m:m.querySelector('[data-palette-listing-id="'+S+'"]');if(w&&w.querySelector("#"+g)===null){const t=document.createElement("div");t.id=g,t.setAttribute("data-heyetsy-listing-id",S);const v={textColor:b,backgroundColor:p,cardShowCategories:f,cardShowTags:A};t.innerHTML=n===E?J(S,v).innerHTML:U(S,v).innerHTML,w.insertAdjacentHTML("beforeend",t.outerHTML)}}for(var M=[];h.length>0;)M.push(h.splice(0,Vt));M.forEach(t=>{const v=t.toString();fetch(`${Q}/bulk/listings/${v}`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${i}`}}).then(r=>r.ok?r.json():Promise.reject(r)).then(r=>{var d=r.data;for(let l=0;l<d.length;l++){const a=d[l];var o=a==null?void 0:a.listing_id;if(o){const _=X(a,T),L={textColor:b,backgroundColor:p,isHighlight:_,highlightBackgroundColor:y,cardShowCategories:f,cardShowTags:A};var s=document.querySelectorAll('[data-palette-listing-id="'+o+'"]');for(let H=0;H<s.length;H++){const k=s[H];k.querySelector("#"+g)!==null&&(k.querySelector("#"+g).innerHTML=n===E?I(o,a,L).innerHTML:R(o,a,L).innerHTML,Y(k,a))}}}}).catch(r=>{r instanceof Error&&K.trackEvent(V,{errorMessage:r.message,stack:r.stack});for(let d=0;d<t.length;d++){const o=t[d];if(o){const s=document.querySelectorAll(`div[data-heyetsy-listing-id="${o}"]`)||[];for(let l=0;l<s.length;l++){const a=s[l];a&&(a.innerHTML=n===E?W(r).innerHTML:F(r).innerHTML)}}}})})}},Zt=25,te='ul[id="search-results"], .responsive-listing-grid',ee='ul[id="search-results"] > li, .responsive-listing-grid > div',ie=(i=!1)=>{i&&console.info("market handler")},re=async(i=!1)=>{i&&console.log("market injector"),(await q.get(P)==null||await q.get(P))&&(setTimeout(yt,2e3),new MutationObserver(e=>{e.forEach(n=>{n.type=="attributes"&&n.target==document.body&&setTimeout(yt,2e3)})}).observe(document.body,{attributes:!0,childList:!1,subtree:!1}))};function ne(i){const e=/[https:\/\/www.etsy.com\/listing\/]([0-9]+)/;var n;return(n=e.exec(i))!==null?n[1]:!1}const yt=async()=>{const i=await q.get(Z);if(!i)return;const e=await q.getKeys([O,N,G,j,z,x,$]),n=e[O]||D,b=e[N]||tt,p=e[G]||et,T=e[j]?JSON.parse(e[j]):nt,y=e[z]||ot,f=e[x]==null?it:e[x],A=e[$]==null?rt:e[$];if(document.querySelectorAll(te).length>0){var u=document.querySelectorAll(ee);u=Array.from(u).filter(function(t){return t.querySelector("#"+g)===null});for(var h=[...new Set([...u].map(t=>t.hasAttribute("data-palette-listing-id")?t.getAttribute("data-palette-listing-id"):t.querySelector("[data-palette-listing-id]")?t.querySelector("[data-palette-listing-id]").getAttribute("data-palette-listing-id"):t.querySelectorAll(".listing-link").length>0?ne(t.querySelectorAll(".listing-link")[0].getAttribute("href")):!1).filter(Boolean))],c=0;c<u.length;++c){var C=u[c],m=C,S=m.querySelector("[data-palette-listing-id]")?C.querySelector("[data-palette-listing-id]").getAttribute("data-palette-listing-id"):!1,w=m.hasAttribute("data-palette-listing-id")?m:m.querySelector('[data-palette-listing-id="'+S+'"]');if(w&&w.querySelector("#"+g)===null){const t=document.createElement("div");t.id=g,t.setAttribute("data-heyetsy-listing-id",S);const v={textColor:b,backgroundColor:p,cardShowCategories:f,cardShowTags:A};t.innerHTML=n===E?J(S,v).innerHTML:U(S,v).innerHTML,w.insertAdjacentHTML("beforeend",t.outerHTML)}}for(var M=[];h.length>0;)M.push(h.splice(0,Zt));M.forEach(t=>{const v=t.toString();fetch(`${Q}/bulk/listings/${v}`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${i}`}}).then(r=>r.ok?r.json():Promise.reject(r)).then(r=>{var d=r.data;for(let l=0;l<d.length;l++){const a=d[l];var o=a==null?void 0:a.listing_id;if(o){const _=X(a,T),L={textColor:b,backgroundColor:p,isHighlight:_,highlightBackgroundColor:y,cardShowCategories:f,cardShowTags:A};var s=document.querySelectorAll('[data-palette-listing-id="'+o+'"]');for(let H=0;H<s.length;H++){const k=s[H];k.querySelector("#"+g)!==null&&(k.querySelector("#"+g).innerHTML=n===E?I(o,a,L).innerHTML:R(o,a,L).innerHTML,Y(k,a))}}}}).catch(r=>{r instanceof Error&&(console.log(r),K.trackEvent(V,{errorMessage:r.message,stack:r.stack}));for(let d=0;d<t.length;d++){const o=t[d];if(o){const s=document.querySelectorAll(`div[data-heyetsy-listing-id="${o}"]`)||[];for(let l=0;l<s.length;l++){const a=s[l];a&&(a.innerHTML=n===E?W(r).innerHTML:F(r).innerHTML)}}}})})}},oe="#favorite_listings_panel ul:first-child > li, #reorderable-listing-results > li, .listing-cards > li, .responsive-listing-grid > li, #search-results > li, .search-listings-group li, div[data-appears-component-name='shop_home_listings_section'] div.v2-listing-card, .responsive-listing-grid > div, ul.toolkit-carousel-inner > li, ul.wt-block-grid > li, ul[data-listings-grid] > div",ae=(i=!1)=>{i&&console.info("metadata handler")},le=async(i=!1)=>{i&&console.log("metadata injector");const e=document.querySelectorAll(oe);var n=[...new Set([...e].map(b=>{var p=b,T=p.querySelector("[data-palette-listing-id]")?b.querySelector("[data-palette-listing-id]").getAttribute("data-palette-listing-id"):!1;if(!T)return!1;var y=p.hasAttribute("data-palette-listing-id")?p:p.querySelector('[data-palette-listing-id="'+T+'"]'),f=y?y.querySelectorAll(".wt-badge--sale-01").length>0:!1,A=y?y.textContent.toLowerCase().includes("Bestseller".toLowerCase()):!1,u=y?y.textContent.toLowerCase().includes("Popular now".toLowerCase()):!1,h=y?y.textContent.toLowerCase().includes("Etsy\u2019s Pick".toLowerCase()):!1,c=y?y.querySelectorAll(".v2-listing-card__info div.text-danger.text-body-smaller").length>0:!1;return{listing_id:T,freeShipping:f,bestSeller:A,popularNow:u,etsyPick:h,lowStock:c}}).filter(Boolean))];chrome.runtime.sendMessage({type:"META_DATA",data:n})};(await q.get(St)==null?!0:await q.get(St))&&(window.location.href.match(/\/c\//)&&(Lt(B),Tt(B)),window.location.href.match(/\/shop\//)&&(Et(B),_t(B)),window.location.href.match(/\/listing\//)&&(Gt(B),zt(B)),window.location.href.match(/\/people\//)&&(Ut(B),It(B)),window.location.href.match(/\/search/)&&(Qt(B),Xt(B)),window.location.href.match(/\/market/)&&(ie(B),re(B))),bt(B),vt(B),ae(B),le(B),chrome.runtime.onMessage.addListener((i,e,n)=>{switch(i.type){case"RELOAD_PAGE":window.location.reload();break}}),K.trackEvent(de);const se=chrome.runtime?chrome.runtime.getManifest():{version:"N/A"},ce=se.version;K.trackEvent(he,{version:ce})});
